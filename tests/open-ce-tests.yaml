tests:
  - name: Setup TorchText Tests
    command: |
        TEXT_VERSION=$(python -c "import torchtext; print(torchtext.__version__)")
        TAG=${TEXT_VERSION/a0+*/}
        conda install -y git
        git clone https://github.com/pytorch/text.git
        cd text
        git checkout v${TAG}
        rm -rf torchtext
        conda install -y pytest mock sentencepiece nltk parameterized
        pip install revtok expecttest
  - name: Run TorchText tests
    command: |
        cd text
        TESTSUITES_TO_RUN=(
                      test/test_functional.py
                      test/test_transforms.py
                      test/test_utils.py
                      test/test_vocab.py
                      test/data/test_functional.py
                      test/data/test_modules.py
        )
        for test_suite in "${TESTSUITES_TO_RUN[@]}"
        do
          TEST_SUITES+="$test_suite "
        done
        pytest -v --ignore='test/test_build.py' -k "not test_multi30k and not test_iwslt2016 and not test_iwslt2017" ${TEST_SUITES}
  - name: Clean tests
    command: rm -rf text
